<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hello Convex!</title>
  </head>
  <body>
    <div id="root"></div>

    <script src="/thirdparty/pixi.min.js"></script>
    <script src="/src/map.js"></script>
    <script type="module">

    import { InternalConvexClient, ConvexHttpClient } from "convex-dev/browser";
    import convexConfig from "/convex.json";


    // PIXI global initialization. 
    const app = vex_init_pixi(); // defined in src/map.js 
    set_g_app_map(app);
    // //Add the canvas that Pixi automatically created for you to the HTML document
    document.body.appendChild(app.view);

    // CONVEX global initialization
    const convexhttp = new ConvexHttpClient(convexConfig.origin);
    const internal   = new InternalConvexClient(convexConfig.origin, updatedQueries => reactive_update(updatedQueries));

    set_g_convex_http_client_map(convexhttp);
    set_g_convex_internal_client_map(internal);

    // get notified on any changed to the following query. Changes will
    // call "reactive_update"
    const { queryToken, unsubscribe } = internal.subscribe("getMap", []);


    let hero_char   = "@";

    let cur_map   = null;
    let pixi_hero = null;

    // setup left hand sidebar
    set_rand_banner();
    // first map
    set_initial_map();
    // create hero and place on map
    set_hero();


function set_hero() {
    const herosty = new PIXI.TextStyle({
      fontFamily: "Courier",
      fontSize: MAP_FONT_SIZE,
      fill: "yellow",
      fontWeight : "bolder"
    });

    pixi_hero = new PIXI.Text(hero_char, herosty);
    pixi_hero.interactive = true;
    set_g_pixi_hero_map(pixi_hero);

    app.stage.addChild(pixi_hero);
}


  </script>
  </body>
</html>
