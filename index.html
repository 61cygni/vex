<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hello Convex!</title>
  </head>
  <body>
    <div id="root"></div>

    <script>
        let MAP_FONT_SIZE    = 16; // px  

        let MAP_WIDTH_CHAR   = 64;  
        let MAP_HEIGHT_CHAR  = 40;
        let SCREEN_WIDTH     = 1024; // px
        let SCREEN_HEIGHT    = 768;

        // font widths in pixels. Figured out through trial and error .. so
        // clearly brittle 
        let FONT_PIXEL_W = 11;
        let FONT_PIXEL_H = 18;

        // Upper left corner of map on the screen
        let MAP_X_OFFSET = 0; // can only be calculated once we have the map 
        let MAP_Y_OFFSET = FONT_PIXEL_H;

        // Position of main hero sidebar
        let HERO_SIDEBAR_W = 128;
        let HERO_SIDEBAR_H = 64;
        let HERO_SIDEBAR_X_OFFSET =  6; 
        let HERO_SIDEBAR_Y_OFFSET = MAP_Y_OFFSET;


        function keyboard(value) {
          const key = {};
          key.value = value;
          key.isDown = false;
          key.isUp = true;
          key.press = undefined;
          key.release = undefined;
          //The `downHandler`
          key.downHandler = (event) => {
            if (event.key === key.value) {
              if (key.isUp && key.press) {
                key.press();
              }
              key.isDown = true;
              key.isUp = false;
              event.preventDefault();
            }
          };

          //The `upHandler`
          key.upHandler = (event) => {
            if (event.key === key.value) {
              if (key.isDown && key.release) {
                key.release();
              }
              key.isDown = false;
              key.isUp = true;
              event.preventDefault();
            }
          };

          //Attach event listeners
          const downListener = key.downHandler.bind(key);
          const upListener = key.upHandler.bind(key);
          
          window.addEventListener("keydown", downListener, false);
          window.addEventListener("keyup", upListener, false);
          
          // Detach event listeners
          key.unsubscribe = () => {
            window.removeEventListener("keydown", downListener);
            window.removeEventListener("keyup", upListener);
          };
          
          return key;
        }
    </script>

    <script type="module" src="/src/map.js"></script>
    <script type="module" src="/src/hero.js"></script>
    <script type="module" src="/src/title.js"></script>
    <script type="module">

    import { set_g_app_title, init_and_set_title} from "/src/title.js";
    import { set_g_pixi_hero_map, set_initial_map, vex_init_pixi, set_g_app_map} from "/src/map.js";
    import { init_pixi_hero, set_g_pixi_hero_hero, set_g_app_hero} from "/src/hero.js";

    // PIXI global initialization. 
    const g_app = vex_init_pixi(); // defined in src/map.js 

    function f(){
        console.log("FFFFFFFF");
    }

    set_g_app_map(g_app);
    set_g_app_hero(g_app);
    set_g_app_title(g_app);

    // //Add the canvas that Pixi automatically created for you to the HTML document
    document.body.appendChild(g_app.view);

    init_and_set_title(); // title screen will take it from here

  </script>
  </body>
</html>
